<!DOCTYPE html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="UTF-8">
  <title th:text="${opportunity.title} + ' | Volunteer Opportunity'">Volunteer Opportunity Details</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link th:href="@{/css/styles.css}" rel="stylesheet">
  <link th:href="@{/css/volunteering_detail.css}" rel="stylesheet">
  <script defer th:src="@{/js/volunteering-detail.js}"></script>
</head>
<body>
<div th:replace="fragments/nav :: navbar"></div>

<main>
  <section class="hero">
    <div class="container">
      <h1 id="opportunity-title" th:text="${opportunity.title}">Volunteer Opportunity Details</h1>
      <p class="muted">Learn more about this volunteer opportunity</p>
    </div>
  </section>

  <section class="container">
    <div class="opportunity-detail">
      <div class="opportunity-header">
        <div class="opportunity-meta">
          <span class="badge badge-primary" th:text="${opportunity.type}"></span>
          <span class="badge"
                th:classappend="${opportunity.status.name() == 'OPEN'} ? ' badge-success' : ' badge-warning'"
                th:text="${opportunity.status}"></span>
          <span class="badge badge-secondary" th:text="${opportunity.location}"></span>
        </div>
        <div class="opportunity-dates">
          <span id="opportunity-dates"
                th:text="${#temporals.format(opportunity.startDate,'MMM d, yyyy')} + ' - ' + ${#temporals.format(opportunity.endDate,'MMM d, yyyy')}"></span>
        </div>
      </div>

      <div class="posted-by">
        <h3>Posted by</h3>
        <p id="posted-by-name" th:text="${opportunity.postedByName}">User</p>
      </div>

      <div class="opportunity-info">
        <div class="info-grid">
          <div class="info-item"><h4>Type</h4><p id="type-text" th:text="${opportunity.type}"></p></div>
          <div class="info-item"><h4>Location</h4><p id="location-text" th:text="${opportunity.location}"></p></div>
          <div class="info-item"><h4>Start Date</h4><p id="start-date-text" th:text="${#temporals.format(opportunity.startDate,'MMM d, yyyy')}"></p></div>
          <div class="info-item"><h4>End Date</h4><p id="end-date-text" th:text="${#temporals.format(opportunity.endDate,'MMM d, yyyy')}"></p></div>
          <div class="info-item"><h4>Max Volunteers</h4><p id="max-volunteers-text" th:text="${opportunity.maxVolunteers != null ? opportunity.maxVolunteers : 'Unlimited'}"></p></div>
          <div class="info-item"><h4>Status</h4><p id="status-text" th:text="${opportunity.status}"></p></div>
        </div>
      </div>

      <div class="opportunity-description">
        <h3>Description</h3>
        <p id="description-text" th:text="${opportunity.description}"></p>
      </div>

      <div id="requirements-section" class="opportunity-requirements" th:if="${opportunity.requirements != null and !#strings.isEmpty(opportunity.requirements)}">
        <h3>Requirements</h3>
        <p id="requirements-text" th:text="${opportunity.requirements}"></p>
      </div>

      <div id="contact-section" class="opportunity-contact" th:if="${opportunity.contactInfo != null and !#strings.isEmpty(opportunity.contactInfo)}">
        <h3>Contact Information</h3>
        <p id="contact-text" th:text="${opportunity.contactInfo}"></p>
      </div>

      <div class="opportunity-actions" style="gap:8px; display:flex; align-items:center;">
        <!-- Apply (server-rendered form; JS enhances with fetch) -->
        <form th:if="${opportunity.status.name() == 'OPEN' and !alreadyApplied and !isOwner}"
              th:action="@{|/volunteering/${opportunity.id}/apply|}" method="post" id="apply-form">
          <button id="apply-btn" class="btn btn-primary" type="submit">Apply to Volunteer</button>
        </form>

        <!-- Already applied info -->
        <span class="badge badge-secondary" th:if="${alreadyApplied}">You already applied</span>

        <!-- Delete (owner/admin only) -->
        <form th:if="${isOwner or isAdmin}"
              th:action="@{|/volunteering/${opportunity.id}|}" method="post"
              onsubmit="return confirm('Delete this opportunity? This cannot be undone.');">
          <input type="hidden" name="_method" value="delete"/>
          <button id="delete-btn" class="btn btn-danger" type="submit">Delete Opportunity</button>
        </form>

        <a th:href="@{/volunteering}" class="btn btn-ghost">Back to Opportunities</a>
      </div>

      <!-- Messages -->
      <div id="success-message" class="alert alert-success" style="display:none;">
        <p>Application submitted successfully!</p>
      </div>
      <div id="error-message" class="alert alert-error" style="display:none;">
        <p id="error-text">An error occurred. Please try again.</p>
      </div>
    </div>
  </section>
</main>
</body>
</html>
